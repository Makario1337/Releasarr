{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>SABnzbd Settings</h2>
    <hr>

    {# Display messages (success or error) #}
    {% if request.query_params.get('message') %}
    <div class="alert alert-success" role="alert">
        {{ request.query_params.get('message') }}
    </div>
    {% endif %}

    {% if request.query_params.get('error') %}
    <div class="alert alert-danger" role="alert">
        {{ request.query_params.get('error') }}
    </div>
    {% endif %}

    <form action="/settings/sabnzbd" method="post" class="mb-4">
        <div class="mb-3">
            <label for="path_mapping" class="form-label">Path Mapping (Local Path:Remote Path):</label>
            <input type="text" class="form-control" id="path_mapping" name="path_mapping"
                   value="{{ path_mapping }}"
                   placeholder="/path/to/local:/path/to/remote"
                   aria-describedby="pathMappingHelp">
            <div id="pathMappingHelp" class="form-text">
                Optional. Map a local path to a remote path if your SABnzbd is on a different system.
                Example: <code>/downloads/complete:/media/downloads</code>
            </div>
        </div>

        <div class="mb-3">
            <label for="ip_address" class="form-label">SABnzbd IP Address:</label>
            <input type="text" class="form-control" id="ip_address" name="ip_address"
                   value="{{ ip_address }}"
                   placeholder="192.168.1.100" required>
        </div>

        <div class="mb-3">
            <label for="port" class="form-label">SABnzbd Port:</label>
            <input type="number" class="form-control" id="port" name="port"
                   value="{{ port }}"
                   placeholder="8080" required>
        </div>

        <div class="mb-3">
            <label for="api_key" class="form-label">SABnzbd API Key:</label>
            <input type="text" class="form-control" id="api_key" name="api_key"
                   value="{{ api_key }}"
                   placeholder="YourSABnzbdApiKey" required>
            <div class="form-text">
                You can find your API key in SABnzbd settings under "General" or "API Keys".
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Save SABnzbd Settings</button>
    </form>

    <h3 class="mt-5">Test SABnzbd Connection</h3>
    <p>Verify that Releasarr can connect to your SABnzbd instance with the saved settings.</p>
    <form action="/settings/sabnzbd/test" method="post">
        {# Hidden inputs to pass current values for the test, though the backend fetches them from DB #}
        <input type="hidden" name="ip_address" value="{{ ip_address }}">
        <input type="hidden" name="port" value="{{ port }}">
        <input type="hidden" name="api_key" value="{{ api_key }}">
        <button type="submit" class="btn btn-info">Test Connection</button>
    </form>
</div>
{% endblock %}
