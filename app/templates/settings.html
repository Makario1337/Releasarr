{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>‚öôÔ∏è Settings</h2>
    <hr>

    {% if message %}
    <div class="alert alert-success" role="alert">
        {{ message }}
    </div>
    {% endif %}

    {% if error_message %}
    <div class="alert alert-danger" role="alert">
        {{ error_message }}
    </div>
    {% endif %}

    <div class="settings-groups">
        {% for group_name, configs in grouped_configs.items() %}
        <h3>{{ group_name }}</h3>
        <table class="config-table mb-4">
            <thead>
                <tr>
                    <th>Key</th>
                    <th>Value</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for config in configs %}
                <tr>
                    <td>
                        <label for="{{ config.Key }}">{{ config.Key | replace('_', ' ') }}:</label>
                    </td>
                    <td colspan="2"> 
                        {% if config.Key == 'DeezerDownloadQuality' %}
                            <form action="{{ url_for('save_setting') }}" method="post" class="d-flex align-items-center" style="gap: 5px;">
                                <select id="{{ config.Key }}" name="value" class="form-control">
                                    {% for option in config.options %}
                                        <option value="{{ option }}" {% if option == config.Value %}selected{% endif %}>
                                            {{ option }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <input type="hidden" name="key" value="{{ config.Key }}">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                            </form>
                        {% elif config.Key == 'SabnzbdSSL' %}
                            <form action="{{ url_for('save_setting') }}" method="post" class="d-flex align-items-center" style="gap: 5px;">
                                <select id="{{ config.Key }}" name="value" class="form-control">
                                    {% for option in config.options %}
                                        <option value="{{ option }}" {% if option == config.Value %}selected{% endif %}>
                                            {{ option }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <input type="hidden" name="key" value="{{ config.Key }}">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                            </form>
                        {% else %}
                            <form action="{{ url_for('save_setting') }}" method="post" class="d-flex align-items-center" style="gap: 5px;">
                                <input type="text" 
                                    id="{{ config.Key }}" 
                                    name="value" 
                                    class="form-control" 
                                    value="{{ config.Value }}"
                                    {% if config.Key=='DeezerARLKey' %}placeholder="Your Deezer ARL Key"{% endif %}
                                    {% if config.Key=='SpotifyApiKey' %}placeholder="Your Spotify API Key"{% endif %}
                                    {% if config.Key=='TidalAPIKey' %}placeholder="Your Tidal API Key"{% endif %}
                                    {% if config.Key=='DiscogsApiKey' %}placeholder="Your Discogs API Key"{% endif %}
                                    {% if config.Key=='SabnzbdIP' %}placeholder="Sabnzbd IP or hostname"{% endif %}
                                    {% if config.Key=='SabnzbdPort' %}placeholder="Sabnzbd Port"{% endif %}
                                    {% if config.Key=='SabnzbdAPIKey' %}placeholder="Enter your SABnzbd API key"{% endif %}
                                    {% if config.Key=='SabnzbdPathMapping' %}placeholder="e.g., /mnt/downloads/completed"{% endif %}
                                    {% if config.Key=='SabnzbdUsername' %}placeholder="Your SABnzbd Username"{% endif %}
                                    {% if config.Key=='SabnzbdPassword' %}placeholder="Your SABnzbd Password"{% endif %}
                                    {% if config.Key=='LibraryFolderPath' %}placeholder="Path to your music library"{% endif %}
                                    {% if config.Key=='ImportFolderPath' %}placeholder="Path for new imports"{% endif %}
                                    {% if config.Key=='WatchFolderPath' %}placeholder="Path to watch for new downloads"{% endif %}>
                                <input type="hidden" name="key" value="{{ config.Key }}">
                                <button type="submit" class="btn btn-primary btn-sm">Save</button>
                            </form>
                        {% endif %}
                        {% if config.Key == 'SabnzbdAPIKey' %}
                            <form action="{{ url_for('test_connection') }}" method="post" class="mt-2">
                                <button type="submit" class="btn btn-info btn-sm">‚ö° Test Connection</button>
                            </form>
                        {% elif config.Key in ["LibraryFolderPath", "ImportFolderPath", "WatchFolderPath"] %}
                            <form action="{{ url_for('test_general_path') }}" method="post" class="mt-2">
                                <input type="hidden" name="key" value="{{ config.Key }}">
                                <input type="hidden" name="value" value="{{ config.Value }}">
                                <button type="submit" class="btn btn-info btn-sm">üóÇÔ∏è Test Path</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
                {% if config.free_space_gb is not none %}
                <tr>
                    <td></td>
                    <td colspan="2">
                        <small class="text-muted">
                            Total Space: {{ config.total_space_gb }} GB | Free Space: {{ config.free_space_gb }} GB
                        </small>
                    </td>
                </tr>
                {% endif %}
                {% if config.path_error %}
                <tr>
                    <td></td>
                    <td colspan="2">
                        <p class="text-danger">{{ config.path_error }}</p>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
        {% endfor %}
    </div>
</div>

<style>
    .settings-groups h3 {
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #1d3557;
        border-bottom: 2px solid #a8dadc;
        padding-bottom: 0.5rem;
    }

    .config-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 12px;
        margin-top: 1em;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        font-size: 0.95rem;
    }

    .config-table thead tr {
        background-color: #457b9d;
        color: white;
        text-align: left;
    }

    .config-table th,
    .config-table td {
        padding: 12px 16px;
        vertical-align: middle;
        border-bottom: 1px solid #eee;
    }

    .config-table form {
        width: 100%;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .config-table .form-control {
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 0.9rem;
        border-radius: 0.25rem;
        border: 1px solid #ced4da;
    }

    .button-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .config-table .btn {
        min-width: unset;
        height: auto;
        padding: 0.375rem 0.75rem;
        font-size: 0.85rem;
        width: 100%;
        box-sizing: border-box;
    }

    .form-text {
        font-size: 0.75rem;
        color: #6c757d;
        margin-top: 0.25rem;
    }

    .form-text.text-danger {
        color: #dc3545 !important;
    }
</style>
{% endblock %}